/*! Version: 0.43.0
Date: 2015-05-27 */
/*!
Copyright (c) 2014 Dominik Moritz

This file is part of the leaflet locate control. It is licensed under the MIT license.
You can find the project at: https://github.com/domoritz/leaflet-locatecontrol
*/
!function(t,i){"function"==typeof define&&define.amd?define(["leaflet"],t):"object"==typeof exports&&(module.exports=t(void 0!==i&&i.L?L:require("leaflet"))),void 0!==i&&i.L&&(i.L.Locate=t(L))}((function(t){return t.Control.Locate=t.Control.extend({options:{position:"topleft",drawCircle:!0,follow:!1,stopFollowingOnDrag:!1,remainActive:!1,markerClass:t.circleMarker,circleStyle:{color:"#136AEC",fillColor:"#136AEC",fillOpacity:.15,weight:2,opacity:.5},markerStyle:{color:"#136AEC",fillColor:"#2A93EE",fillOpacity:.7,weight:2,opacity:.9,radius:5},followCircleStyle:{},followMarkerStyle:{},icon:"fa fa-map-marker",iconLoading:"fa fa-spinner fa-spin",circlePadding:[0,0],metric:!0,onLocationError:function(t){alert(t.message)},onLocationOutsideMapBounds:function(t){t.stop(),alert(t.options.strings.outsideMapBoundsMsg)},setView:!0,keepCurrentZoomLevel:!1,showPopup:!0,strings:{title:"Show me where I am",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"},locateOptions:{maxZoom:1/0,watch:!0}},initialize:function(i){for(var o in t.Map.addInitHook((function(){this.options.locateControl&&this.addControl(this)})),i)"object"==typeof this.options[o]?t.extend(this.options[o],i[o]):this.options[o]=i[o];t.extend(this.options.locateOptions,{setView:!1})},_activate:function(){this.options.setView&&(this._locateOnNextLocationFound=!0),this._active||this._map.locate(this.options.locateOptions),this._active=!0,this.options.follow&&this._startFollowing(this._map)},_deactivate:function(){this._map.stopLocate(),this._map.off("dragstart",this._stopFollowing),this.options.follow&&this._following&&this._stopFollowing(this._map)},drawMarker:function(i){void 0===this._event.accuracy&&(this._event.accuracy=0);var o,s,e,n,a,l=this._event.accuracy;if(this._locateOnNextLocationFound&&(this._isOutsideMapBounds()?this.options.onLocationOutsideMapBounds(this):this.options.keepCurrentZoomLevel||!this.options.drawCircle?i.panTo([this._event.latitude,this._event.longitude]):i.fitBounds(this._event.bounds,{padding:this.options.circlePadding,maxZoom:this.options.keepCurrentZoomLevel?i.getZoom():this.options.locateOptions.maxZoom}),this._locateOnNextLocationFound=!1),this.options.drawCircle)if(o=this._following?this.options.followCircleStyle:this.options.circleStyle,this._circle)for(s in this._circle.setLatLng(this._event.latlng).setRadius(l),o)this._circle.options[s]=o[s];else this._circle=t.circle(this._event.latlng,l,o).addTo(this._layer);this.options.metric?(e=l.toFixed(0),n="meters"):(e=(3.2808399*l).toFixed(0),n="feet"),a=this._following?this.options.followMarkerStyle:this.options.markerStyle,this._marker?this.updateMarker(this._event.latlng,a):this._marker=this.createMarker(this._event.latlng,a).addTo(this._layer);var r=this.options.strings.popup;this.options.showPopup&&r&&this._marker.bindPopup(t.Util.template(r,{distance:e,unit:n}))._popup.setLatLng(this._event.latlng),this._toggleContainerStyle()},createMarker:function(t,i){return this.options.markerClass(t,i)},updateMarker:function(t,i){for(var o in this._marker.setLatLng(t),i)this._marker.options[o]=i[o]},removeMarker:function(){this._layer.clearLayers(),this._marker=void 0,this._circle=void 0},onAdd:function(i){var o=t.DomUtil.create("div","leaflet-control-locate leaflet-bar leaflet-control");this._layer=new t.LayerGroup,this._layer.addTo(i),this._event=void 0;var s={};return t.extend(s,this.options.markerStyle,this.options.followMarkerStyle),this.options.followMarkerStyle=s,s={},t.extend(s,this.options.circleStyle,this.options.followCircleStyle),this.options.followCircleStyle=s,this._link=t.DomUtil.create("a","leaflet-bar-part leaflet-bar-part-single",o),this._link.href="#",this._link.title=this.options.strings.title,this._icon=t.DomUtil.create("span",this.options.icon,this._link),t.DomEvent.on(this._link,"click",t.DomEvent.stopPropagation).on(this._link,"click",t.DomEvent.preventDefault).on(this._link,"click",(function(){var t=void 0===this._event||this._map.getBounds().contains(this._event.latlng)||!this.options.setView||this._isOutsideMapBounds();!this.options.remainActive&&this._active&&t?this.stop():this.start()}),this).on(this._link,"dblclick",t.DomEvent.stopPropagation),this._resetVariables(),this.bindEvents(i),o},bindEvents:function(t){t.on("locationfound",this._onLocationFound,this),t.on("locationerror",this._onLocationError,this),t.on("unload",this.stop,this)},start:function(){this._activate(),this._event?this.drawMarker(this._map):this._setClasses("requesting")},stop:function(){this._deactivate(),this._cleanClasses(),this._resetVariables(),this.removeMarker()},_onLocationError:function(t){3==t.code&&this.options.locateOptions.watch||(this.stop(),this.options.onLocationError(t))},_onLocationFound:function(t){this._event&&this._event.latlng.lat===t.latlng.lat&&this._event.latlng.lng===t.latlng.lng&&this._event.accuracy===t.accuracy||this._active&&(this._event=t,this.options.follow&&this._following&&(this._locateOnNextLocationFound=!0),this.drawMarker(this._map))},_startFollowing:function(){this._map.fire("startfollowing",this),this._following=!0,this.options.stopFollowingOnDrag&&this._map.on("dragstart",this._stopFollowing,this)},_stopFollowing:function(){this._map.fire("stopfollowing",this),this._following=!1,this.options.stopFollowingOnDrag&&this._map.off("dragstart",this._stopFollowing),this._toggleContainerStyle()},_isOutsideMapBounds:function(){return void 0!==this._event&&(this._map.options.maxBounds&&!this._map.options.maxBounds.contains(this._event.latlng))},_toggleContainerStyle:function(){this._container&&this._setClasses(this._following?"following":"active")},_setClasses:function(i){"requesting"==i?(t.DomUtil.removeClasses(this._container,"active following"),t.DomUtil.addClasses(this._container,"requesting"),t.DomUtil.removeClasses(this._icon,this.options.icon),t.DomUtil.addClasses(this._icon,this.options.iconLoading)):"active"==i?(t.DomUtil.removeClasses(this._container,"requesting following"),t.DomUtil.addClasses(this._container,"active"),t.DomUtil.removeClasses(this._icon,this.options.iconLoading),t.DomUtil.addClasses(this._icon,this.options.icon)):"following"==i&&(t.DomUtil.removeClasses(this._container,"requesting"),t.DomUtil.addClasses(this._container,"active following"),t.DomUtil.removeClasses(this._icon,this.options.iconLoading),t.DomUtil.addClasses(this._icon,this.options.icon))},_cleanClasses:function(){t.DomUtil.removeClass(this._container,"requesting"),t.DomUtil.removeClass(this._container,"active"),t.DomUtil.removeClass(this._container,"following"),t.DomUtil.removeClasses(this._icon,this.options.iconLoading),t.DomUtil.addClasses(this._icon,this.options.icon)},_resetVariables:function(){this._active=!1,this._locateOnNextLocationFound=this.options.setView,this._following=!1}}),t.control.locate=function(i){return new t.Control.Locate(i)},i=function(i,o,s){(s=s.split(" ")).forEach((function(s){t.DomUtil[i].call(this,o,s)}))},t.DomUtil.addClasses=function(t,o){i("addClass",t,o)},t.DomUtil.removeClasses=function(t,o){i("removeClass",t,o)},t.Control.Locate;var i}),window);